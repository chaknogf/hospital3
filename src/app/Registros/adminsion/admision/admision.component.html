<h2 class="text-center text-white">{{ enEdicion ? 'Editar Admisión' : 'Nueva Admisión' }}</h2>
<div class="container">
  <div class="botones">
    <button type="button" (click)="volver()">
      <span [innerHTML]="cancelIcon"></span>
      Cancelar
    </button>

    <button type="submit" (click)="guardar()">
      <span [innerHTML]="saveIcon"></span>
      Guardar
    </button>
  </div>
</div>

<form [formGroup]="form" class="formulario-moderno" (ngSubmit)="guardar()">
  <!-- Anti-autocompletado -->
  <input type="text" name="fakeusernameremembered" style="display: none;" />
  <input type="password" name="fakepasswordremembered" style="display: none;" />

  <!-- Datos del Paciente -->
  <fieldset class="grupo" >
    <legend>Datos del Paciente</legend>
    <span>Paciente: {{ paciente.id }} Consulta: {{ form.get('id')?.value }} </span>
    <label for="Nombre_completo">Nombre: </label>
    <div class="resumen">
  <ng-container *ngIf="paciente?.nombre">
    {{ paciente.nombre.primer_nombre || '' }}
    {{ paciente.nombre.segundo_nombre || '' }}
    {{ paciente.nombre.otro_nombre || '' }}
    {{ paciente.nombre.primer_apellido || '' }}
    {{ paciente.nombre.segundo_apellido || '' }}
    {{ paciente.nombre.apellido_casada || '' }}
  </ng-container>
</div>
      <label for="cui">CUI:</label>
      <div class="resumen">
        {{ paciente.cui || '' | cui  }}
      </div>

      <label for="expediente">Expediente:</label>
      <div class="resumen">
        {{paciente.expediente}}
      </div>

      <label for="fecha_nacimiento">Fecha de Nacimiento:</label>
      <div class="resumen">
        {{paciente.fecha_nacimiento | date: 'dd/MM/yyyy'}}

      </div>
      <div class="resumen">
        {{paciente.fecha_nacimiento | edad }}
      </div>
      <label for="sexo">Sexo:</label>
      <div class="resumen">
        <ng-container *ngIf="paciente.sexo === 'M'">
          <span [innerHTML]="manIcon"></span>
        </ng-container>
        <ng-container *ngIf="paciente.sexo === 'F'">
          <span  [innerHTML]="womanIcon"></span>
        </ng-container>
       {{paciente.sexo | datosExtra: 'sexo'}}
      </div>
      <label for="direccion">Direccion:</label>
      <div class="resumen">
          {{paciente.contacto?.localidad}}
          {{paciente.contacto?.municipio | datosExtra:'vecindad'}}
      </div>
      <label for="telefonos" *ngIf="paciente.contacto?.telefono || paciente.contacto?.telefono2 || paciente.contacto?.telefono3">Telefonos:</label>
      <div class="resumen">

          {{paciente.contacto?.telefono}}
          {{paciente.contacto?.telefono2}}
          {{paciente.contacto?.telefono3}}
      </div>

  </fieldset>



  <!-- Admisión -->
  <fieldset class="grupo">
    <legend>Admisión</legend>

    <label for="hoja_emergencia" *ngIf="form.get('documento')?.value" placeholder="">Hoja de Emergencia</label>
    <input type="text"
           id="documento"
           formControlName="documento"
          *ngIf="form.get('documento')?.value"
           placeholder="Hoja de Emergencia"
           name="hoja_emergencia"
           autocomplete="off" />

    <label for="tipo_consulta">Tipo de consulta</label>
    <select
     formControlName="tipo_consulta"
      placeholder="Seleccione tipo de consulta"
      name="tipo_consulta"
      [ngClass]="form.get('tipo_consulta')?.value ? 'is-valid' : 'is-null'"
     >
  <option *ngFor="let t of tipoConsulta" [value]="t.value" disabled>
    {{ t.label | titlecase }}
  </option>
</select>



    <label for="especialidad">Especialidad</label>
    <select id="especialidad"
            formControlName="especialidad"
            name="especialidad"
            [ngClass]="form.get('especialidad')?.value ? 'is-valid' : 'is-null'">
      <option *ngFor="let e of especialidades" [value]="e.value">
        {{ e.label | titlecase }}
      </option>
    </select>

    <label for="servicio">Servicio</label>
    <select id="servicio"
            formControlName="servicio"
            name="servicio"
            [ngClass]="form.get('servicio')?.value ? 'is-valid' : 'is-null'">
      <option *ngFor="let s of servicios" [value]="s.value">
        {{ s.label | titlecase }}
      </option>
    </select>

    <label for="fecha_consulta">Fecha de Admisión</label>
    <input type="date"
           id="fecha_consulta"
           formControlName="fecha_consulta"
           name="fecha_consulta"
           [ngClass]="form.get('fecha_consulta')?.value ? 'is-valid' : 'is-null'" />

    <label for="hora_consulta">Hora de Admisión</label>
    <input type="time"
           id="hora_consulta"
           formControlName="hora_consulta"
           name="hora_consulta"
           [ngClass]="form.get('hora_consulta')?.value ? 'is-valid' : 'is-null'" />
  </fieldset>

  <!-- Indicadores -->
  <fieldset class="grupo" [formGroupName]="'indicadores'">
  <legend>Indicadores</legend>

  <div class="checkbox-group">
  <label class="aurora-checkbox">
    <input type="checkbox" formControlName="estudiante_publico" />
    <span>Estudiante Público</span>
  </label>

  <label class="aurora-checkbox">
    <input type="checkbox" formControlName="empleado_publico" />
    <span>Empleado Público</span>
  </label>

  <label class="aurora-checkbox">
    <input type="checkbox" formControlName="accidente_laboral" />
    <span>Accidente Laboral</span>
  </label>

  <label class="aurora-checkbox">
    <input type="checkbox" formControlName="discapacidad" />
    <span>Discapacidad</span>
  </label>

  <label class="aurora-checkbox">
    <input type="checkbox" formControlName="embarazo" />
    <span>Embarazo</span>
  </label>

  <label class="aurora-checkbox">
    <input type="checkbox" formControlName="arma_fuego" />
    <span>Arma de Fuego</span>
  </label>

  <label class="aurora-checkbox">
    <input type="checkbox" formControlName="arma_blanca" />
    <span>Arma Blanca</span>
  </label>

  <label class="aurora-checkbox">
    <input type="checkbox" formControlName="ambulancia" />
    <span>Ambulancia</span>
  </label>

  <label class="aurora-checkbox">
    <input type="checkbox" formControlName="accidente_transito" />
    <span>Accidente Tránsito</span>
  </label>
</div>
</fieldset>
  <!-- Historial -->
  <fieldset>
    <legend>📜 Historial de registros</legend>
    <div class="historial-container">
       <div class="historial-ciclos">
  <ul>
    <li *ngFor="let ciclo of historialCiclos" class="ciclo-item">
      <strong>{{ ciclo.id | titlecase }}</strong> -
      Estado: {{ ciclo.estado }} |
      Usuario: {{ ciclo.usuario }} |
      Fecha: {{ ciclo.registro | date:'short' }} |
      Servicio: {{ ciclo.servicio }}
    </li>
  </ul>
</div>

    </div>


  </fieldset>
</form>
