<h2 class="text-center text-white">{{ enEdicion ? 'Editar Admisión' : 'Nueva Admisión' }}</h2>
<div class="container">
  <div class="botones">
    <button type="button" (click)="volver()">
      <span [innerHTML]="cancelIcon"></span>
      Cancelar
    </button>

    <button type="submit" (click)="guardar()">
      <span [innerHTML]="saveIcon"></span>
      Guardar
    </button>
  </div>
</div>

<form [formGroup]="form" class="formulario-moderno" (ngSubmit)="guardar()">
  <!-- Anti-autocompletado -->
  <input type="text" name="fakeusernameremembered" style="display: none;" />
  <input type="password" name="fakepasswordremembered" style="display: none;" />

  <!-- Datos del Paciente -->
  <fieldset class="grupo" >
    <legend>Datos del Paciente</legend>
    <label for="Nombre_completo">Nombre: </label>
    <div class="resumen">
          {{paciente?.nombre?.primer_nombre}}
          {{paciente?.nombre?.segundo_nombre}}
          {{paciente?.nombre?.otro_nombre}}
          {{paciente?.nombre?.primer_apellido}}
          {{paciente?.nombre?.segundo_apellido}}
          {{paciente?.nombre?.apellido_casada}}
      </div>
      <label for="cui">CUI:</label>
      <div class="resumen">
        {{ paciente?.cui | cui }}
      </div>

      <label for="expediente">Expediente:</label>
      <div class="resumen">
        {{paciente?.expediente}}
      </div>

      <label for="fecha_nacimiento">Fecha de Nacimiento:</label>
      <div class="resumen">
        {{paciente?.fecha_nacimiento | date: 'dd/MM/yyyy'}}

      </div>
      <div class="resumen">
        {{paciente?.fecha_nacimiento | edad }}
      </div>
      <label for="sexo">Sexo:</label>
      <div class="resumen">
        <ng-container *ngIf="paciente?.sexo === 'M'">
          <span [innerHTML]="manIcon"></span>
        </ng-container>
        <ng-container *ngIf="paciente?.sexo === 'F'">
          <span  [innerHTML]="womanIcon"></span>
        </ng-container>
       {{paciente?.sexo | datosExtra: 'sexo'}}
      </div>
      <label for="direccion">Direccion:</label>
      <div class="resumen">
          {{paciente?.contacto?.localidad}}
          {{paciente?.contacto?.municipio | datosExtra:'vecindad'}}
      </div>
      <label for="telefonos" *ngIf="paciente?.contacto?.telefono || paciente?.contacto?.telefono2 || paciente?.contacto?.telefono3">Telefonos:</label>
      <div class="resumen">

          {{paciente?.contacto?.telefono}}
          {{paciente?.contacto?.telefono2}}
          {{paciente?.contacto?.telefono3}}
      </div>

  </fieldset>



  <!-- Admisión -->
  <fieldset class="grupo">
    <legend>Admisión</legend>

    <label for="hoja_emergencia" *ngIf="enEdicion">Hoja de Emergencia</label>
    <input type="text"
           id="hoja_emergencia"
           formControlName="documento"
           *ngIf="enEdicion"
           placeholder="Hoja de Emergencia"
           name="hoja_emergencia"
           autocomplete="off" />

    <label for="tipo_consulta">Tipo de consulta</label>
    <select id="tipo_consulta"
        formControlName="tipo_consulta"
        name="tipo_consulta"
        [ngClass]="form.get('tipo_consulta')?.value ? 'is-valid' : 'is-null'">
  <option *ngFor="let key of tipoConsulta" [value]="key.value">
    {{ key.label | titlecase }}
  </option>
</select>

    <label for="ciclo">Ciclo</label>
    <select
      id="ciclo"
      formControlName="ciclo"
      name="ciclo"
      [ngClass]="form.get('ciclo?')?.value ? 'is-valid' : 'is-null'"
    >
      <option *ngFor="let key of ciclos" [value]="key.value">
        {{ key.label | titlecase }}</option>
    </select>

    <label for="especialidad">Especialidad</label>
    <select id="especialidad"
            formControlName="especialidad"
            name="especialidad"
            [ngClass]="form.get('especialidad')?.value ? 'is-valid' : 'is-null'">
      <option value="">Seleccione especialidad</option>
    </select>

    <label for="servicio">Servicio</label>
    <select id="servicio"
            formControlName="servicio"
            name="servicio"
            [ngClass]="form.get('servicio')?.value ? 'is-valid' : 'is-null'">
      <option value="">Seleccione servicio</option>
    </select>

    <label for="fecha_admision">Fecha de Admisión</label>
    <input type="date"
           id="fecha_admision"
           formControlName="fecha_consulta"
           name="fecha_admision"
           [ngClass]="form.get('fecha_admision')?.value ? 'is-valid' : 'is-null'" />

    <label for="hora_admision">Hora de Admisión</label>
    <input type="time"
           id="hora_admision"
           formControlName="hora_consulta"
           name="hora_admision"
           [ngClass]="form.get('hora_admision')?.value ? 'is-valid' : 'is-null'" />
  </fieldset>

  <!-- Indicadores -->
  <fieldset class="grupo" [formGroupName]="'indicadores'">
  <legend>Indicadores</legend>

  <label>
    <input type="checkbox" formControlName="estudiante_publico" />
    Estudiante Público
  </label>

  <label>
    <input type="checkbox" formControlName="empleado_publico" />
    Empleado Público
  </label>

  <label>
    <input type="checkbox" formControlName="accidente_laboral" />
    Accidente Laboral
  </label>

  <label>
    <input type="checkbox" formControlName="discapacidad" />
    Discapacidad
  </label>

  <label>
    <input type="checkbox" formControlName="embarazo" />
    Embarazo
  </label>

  <label>
    <input type="checkbox" formControlName="arma_fuego" />
    Arma de Fuego
  </label>

  <label>
    <input type="checkbox" formControlName="arma_blanca" />
    Arma Blanca
  </label>

  <label>
    <input type="checkbox" formControlName="ambulancia" />
    Ambulancia
  </label>

  <label>
    <input type="checkbox" formControlName="accidente_transito" />
    Accidente Tránsito
  </label>
</fieldset>
  <!-- Historial -->
  <fieldset>
    <legend>Historial de registros</legend>
    <ul class="historial-grid" formGroupName="sistema" *ngFor="let sistema of sortedSistemas; let i = index">
      <li class="sistema" *ngIf="sistema.fecha">
        {{ sistema.usuario }}:
        <br>
        [{{ sistema.accion }}]
        [{{ sistema.fecha | date:'short' }}]
      </li>
    </ul>
  </fieldset>
</form>
