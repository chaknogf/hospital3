<div class="ficha-paciente" *ngIf="paciente && !cargando">
  <!-- Encabezado -->
  <header class="ficha-header">
    <div class="foto-perfil">
      <span class="avatar"> </span>
    </div>

    <div class="info-header">
      <h1>
        {{ paciente.nombre.primer_apellido | uppercase }}
        {{ paciente.nombre.segundo_apellido | uppercase }}
      </h1>
      <p class="subtitulo">
        {{ paciente.nombre.primer_nombre | titlecase }}
        {{ paciente.nombre.segundo_nombre | titlecase }}
      </p>

      <p
        class="estado_"
        [ngClass]="paciente.estado === 'V' ? 'vivo' : 'fallecido'"
      >
        <span
          class="icon"
          [innerHTML]="paciente.estado === 'V' ? heartIcon : ghostIcon"
        ></span>
        {{ estadoPaciente }}
      </p>
    </div>

    <button class="btn-volver" (click)="regresar()">
      <span [innerHTML]="regresarIcon"></span> Regresar
    </button>
  </header>

  <!-- IdentificaciÃ³n -->
  <section class="section section-cv">
    <h2>ğŸ†” IdentificaciÃ³n</h2>

    <div class="cv-row">
      <span class="cv-label">CUI</span>
      <span class="cv-value">{{ paciente.cui | cui }}</span>
    </div>

    <div class="cv-row">
      <span class="cv-label">Expediente</span>
      <span class="cv-value">
        {{ paciente.expediente || "Sin expediente" }}
      </span>
    </div>

    <div class="cv-row">
      <span class="cv-label">Pasaporte</span>
      <span class="cv-value">
        {{ paciente.pasaporte || "No aplica" }}
      </span>
    </div>
  </section>

  <!-- InformaciÃ³n personal -->
  <section class="section section-cv">
    <h2>ğŸ§¬ Datos Vitales</h2>

    <div class="cv-row">
      <span class="cv-label">Sexo</span>
      <span class="cv-value">
        {{ paciente.sexo?.trim() === "M" ? "Masculino" : "Femenino" }}
      </span>
    </div>

    <div class="cv-row">
      <span class="cv-label">Fecha de nacimiento</span>
      <span class="cv-value">
        {{ paciente.fecha_nacimiento | date : "dd/MM/yyyy" }}
      </span>
    </div>

    <div class="cv-row">
      <span class="cv-label">Edad</span>
      <span class="cv-value">
        {{ paciente.fecha_nacimiento | edad }}
      </span>
    </div>

    <div class="cv-row" *ngIf="fechaDefuncion">
      <span class="cv-label">Fecha de defunciÃ³n</span>
      <span class="cv-value">
        {{ formatearFecha(fechaDefuncion) }}
      </span>
    </div>
  </section>

  <!-- Contacto -->
  <section class="section section-cv">
    <h2>ğŸ“ InformaciÃ³n de Contacto</h2>

    <div class="cv-row" *ngIf="paciente.contacto?.domicilio">
      <span class="cv-label">Domicilio</span>
      <span class="cv-value">{{
        paciente.contacto?.domicilio | titlecase
      }}</span>
    </div>

    <div class="cv-row" *ngIf="paciente.contacto?.municipio">
      <span class="cv-label">Municipio</span>
      <span class="cv-value">
        {{ paciente.contacto?.municipio | datosExtra : "municipio" }}
      </span>
    </div>

    <div class="cv-row" *ngIf="paciente.contacto?.telefonos">
      <span class="cv-label">TelÃ©fonos</span>
      <span class="cv-value">{{ paciente.contacto?.telefonos }}</span>
    </div>
  </section>

  <!-- Referencias -->
  <section class="section section-cv" *ngIf="tieneReferencias">
    <h2>ğŸ‘¥ Referencias</h2>

    <div
      class="cv-reference"
      *ngFor="let ref of paciente.referencias; let i = index"
    >
      <strong>Referencia {{ i + 1 }}</strong
      ><br />
      {{ ref.nombre | titlecase }} â€” {{ ref.parentesco | titlecase }} â€”
      {{ ref.telefonos || "Sin telÃ©fono" }} - {{ ref.expediente }} -
      {{ ref.idpersona }}
    </div>
  </section>

  <!-- Datos DemogrÃ¡ficos -->
  <section class="section section-cv" *ngIf="demograficosFiltrados.length > 0">
    <h2>ğŸŒ Datos DemogrÃ¡ficos</h2>

    <div class="cv-row" *ngFor="let dato of demograficosFiltrados">
      <span class="cv-label">
        {{ convertirClave(dato.key) }}
      </span>
      <span class="cv-value">
        {{ dato.valor | datosExtra : dato.key }}
      </span>
    </div>
  </section>

  <!-- Datos SocioeconÃ³micos -->
  <section
    class="section section-cv"
    *ngIf="socioeconomicosFiltrados.length > 0"
  >
    <h2>ğŸ’¼ Datos SocioeconÃ³micos</h2>

    <div class="cv-row" *ngFor="let dato of socioeconomicosFiltrados">
      <span class="cv-label">
        {{ convertirClave(dato.key) }}
      </span>
      <span class="cv-value">
        {{ dato.valor | datosExtra : dato.key }}
      </span>
    </div>
  </section>

  <!-- Metadatos / Historial -->
  <section class="section section-cv" *ngIf="metadatosKeys.length > 0">
    <h2>ğŸ“Œ InformaciÃ³n del Sistema</h2>

    <div class="cv-row" *ngFor="let key of metadatosKeys">
      <span class="cv-label">
        {{ convertirClave(key) }}
      </span>
      <span class="cv-value">
        {{ paciente.metadatos![key] }}
      </span>
    </div>
  </section>

  <!-- Estado de carga -->
  <div class="loading" *ngIf="cargando">
    <p>Cargando informaciÃ³n del paciente...</p>
  </div>

  <!-- Error -->
  <div class="error" *ngIf="error && !cargando">
    <p>{{ error }}</p>
    <button (click)="regresar()">Regresar</button>
  </div>
</div>
