<div class="ficha-paciente" *ngIf="paciente">
  <!-- Encabezado -->
  <header class="ficha-header">
    <div class="foto-perfil">
      <span class="avatar">{{ paciente.nombre.primer_nombre[0] }}{{ paciente.nombre.primer_apellido[0] }}</span>
    </div>
    <div class="info-header">
      <h1> {{ paciente.nombre.primer_apellido | uppercase }} {{ paciente.nombre.segundo_apellido | uppercase }} </h1>
      <p class="subtitulo">
         {{ paciente.nombre.primer_nombre | titlecase }} {{ paciente.nombre.segundo_nombre | titlecase }}
      </p>
      <p class="estado_" [ngClass]="paciente.estado === 'V' ? 'vivo' : 'fallecido'">
        <span class="icon" [innerHTML]="paciente.estado === 'V' ? heartIcon : ghostIcon"></span>
        {{ paciente.estado === 'V' ? ' Vivo' : ' Fallecido' }}

      </p>
    </div>
    <button class="btn-volver" (click)="regresar()">
      <span [innerHTML]="regresarIcon"></span> Regresar</button>
  </header>

  <!-- Identificadores -->
  <section class="section">
    <h2>ðŸ†” IdentificaciÃ³n</h2>
    <div class="grid-2 section-grid">
      <div class="section-card"><label>CUI:</label> {{ paciente.cui | cui }}</div>
      <div class="section-card"><label>Expediente:</label> {{ paciente.expediente }}</div>
      <div class="section-card"><label>Pasaporte:</label> {{ paciente.pasaporte || 'No aplica' }}</div>
      <div class="section-card"><label>Otro ID:</label> {{ paciente.otro || 'N/A' }}</div>
    </div>
  </section>

  <!-- InformaciÃ³n personal -->
  <section class="section">
    <h2>ðŸŽ‚ Datos Personales</h2>
    <div class="section-grid">
      <div class="section-card sexo-card"><label>Sexo:</label>
       <span class="sexo-icon" [innerHTML]="paciente.sexo === 'M' ? manIcon : womanIcon"></span>
      <p>{{ paciente.sexo === 'M' ? 'Masculino' : 'Femenino' }}</p>
      </div>
      <div class="section-card"><label>Fecha de nacimiento:</label> {{ paciente.fecha_nacimiento | date:'dd/MM/yyyy' }}</div>
      <div class="section-card"><label>Edad:</label> {{ paciente.fecha_nacimiento | edad }}</div>
     <div class="section-card" *ngIf="paciente.datos_extra?.['r11']">
  <label>Lugar de nacimiento:</label>
  {{ paciente.datos_extra?.['r11']?.valor | datosExtra:(paciente.datos_extra?.['r11']?.tipo || '') }}
</div>
    </div>
  </section>

  <!-- Contacto -->
<section class="section">
  <h2>ðŸ“ž Contacto</h2>
  <div class="section-grid">
    <div class="section-card" *ngIf="paciente.contacto?.municipio">
      <label>DirecciÃ³n:</label>
      <p>{{ paciente.contacto?.localidad}} {{ paciente.contacto?.municipio | datosExtra:'vecindad' }}</p>
    </div>



    <div class="section-card" *ngIf="paciente.contacto?.telefono">
      <label>TelÃ©fono 1:</label>
      <p>
        <span *ngIf="paciente.contacto?.telefono">{{ paciente.contacto?.telefono }}</span>

      </p>
    </div>
    <div class="section-card" *ngIf="paciente.contacto?.telefono2">
      <label>TelÃ©fono 2:</label>
      <p>

        <span *ngIf="paciente.contacto?.telefono2">{{ paciente.contacto?.telefono2 }}</span>

      </p>
    </div>
    <div class="section-card" *ngIf="paciente.contacto?.telefono3">
      <label>TelÃ©fono 3:</label>
      <p>
        <span *ngIf="paciente.contacto?.telefono3">{{ paciente.contacto?.telefono3 }}</span>
      </p>
    </div>
  </div>
</section>

  <!-- Referencias -->
  <section class="section" *ngIf="referenciaKeys.length">
    <h2>ðŸ‘¥ Referencias</h2>
    <div class="section-grid grid-2">
      <div class="section-card" *ngFor="let key of referenciaKeys">
        <label class="card-mini">Nombre:</label> {{ paciente.referencias?.[key]?.nombre | uppercase}}
        <label class="card-mini">Parentesco:</label>{{ paciente.referencias?.[key]?.parentesco |datosExtra: 'parentesco' | uppercase}}
        <label class="card-mini">TelÃ©fono:</label>{{ paciente.referencias?.[key]?.telefono }}
      </div>
    </div>
  </section>

  <!-- Datos Extra -->
 <section class="section" *ngIf="datosExtraFiltrados.length">
  <h2>ðŸ“„ Datos Extra</h2>
  <div class="section-grid grid-3">
    <div class="section-card " *ngFor="let dato of datosExtraFiltrados">
      <p class="card-mini"><label>{{ convertirTipo(dato.tipo) }}:</label></p>
      <p>{{ dato.valor | datosExtra:dato.tipo }}</p>
    </div>
  </div>
</section>

  <!-- Metadatos -->
  <section class="section">
    <h2>ðŸ“Œ Historial de cambios</h2>
    <ul class="timeline">
      <li *ngFor="let key of metadatosKeys">
        <span class="usuario">{{ paciente.metadatos?.[key]?.usuario }}</span>
        <span class="fecha">{{ paciente.metadatos?.[key]?.registro | date:'medium' }}</span>
      </li>
    </ul>
  </section>
</div>
